---
title: "Sensivity and Specificity Testing"
author: "Jason T. Serviss"
date: '`r Sys.Date()`'
output:
  html_document:
    theme: flatly
    toc: yes
    code_folding: hide
vignette: >
  %\VignetteIndexEntry{ClusterSignificance Vignette} 
  %\VignetteEngine{knitr::rmarkdown} 
  %\usepackage[utf8]{inputenc}
  %\SweaveUTF8
---

# Read Me
For those not desiring to re-run the whole analysis from scratch, but wanting to explore and re-create the published analysis, the minimal necessary data has been included in the ClusterSignificanceTesting package to achieve this. This included data is utilized when knitting this document.

If you desire to re-run the whole code rom scratch to re-create the analysis, we warn you that it can take some time. Depending on your system, the _zeroOrHundred_, _specificityTest_ and _sensitivityTest_ functions may take hours to days to run. Due to this fact, the chunks containing those function is set to eval=FALSE. We recommend running the above mentioned functions as demonstrated in this document, save the output to your local system, and execute the downstream commands after the output from the functions is loaded into R.

To increase reproducability, all of the functions needed to re-create supplementary fig. 1 are included in the raw package code but are also shown at the end of this document for convienience.

#Introduction
To test ClusterSignificance's sensivity and specificity two datasets were generated using the [zeroOrHundred][Dataset Generation Functions] function. The first of these datasets, [zero][Datasets] was designed to test the sensitivity of ClusterSignificance. It contains input matrixes to ClusterSignificance representing 2 groups in 2 dimensions which have zero percent overlap with each other. Technically this means that, no points from one group occupy the same space as any of the points from the other group. Here we expect ClusterSignificance to detect a significant seperation for each test. The dataset includes ClusterSignificance input matrixes which have different numbers of data points for each group; from 5 to 100. As well, the dataset includes 10 repititions for each number of points per group.

The second of the gererated datasets, named [hundred][Datasets], was designed to test ClusterSignificance's specificity. It has a similar composition as the zero dataset except for the fact that the groups have 100 percent overlap instead of zero. 100 percent overlap, in this context, means that the space which one group occupies is totally overlapping the space of the other group.

In the plots below we show examples from each dataset.


<style>
  .col2 {
    columns: 2 200px;         /* number of columns and width in pixels*/
    -webkit-columns: 2 200px; /* chrome, safari */
    -moz-columns: 2 200px;    /* firefox */
  }
  
  .rawCode {
    font-size: 160%
  }
</style>

```{r style, echo = FALSE, results = 'asis'}
BiocStyle::markdown()
library(printr)
library(knitr)

##the function below allows dynamic insertion of the function source code 
insert_fun = function(name) {
    read_chunk(
      lines = capture.output(dump(name, '')), 
      labels = paste(name, 'source', sep = '-')
    )
}
```

<br></br><br></br>

```{r library, message=FALSE}
library(ClusterSignificanceTesting)
```


# Dataset generation
```{r, eval=FALSE}
#generate the zero dataset, i.e. range overlap = 0
zero <- zeroOrHundred(overlap=0, save=FALSE, verbose=FALSE)

#generate the hundred dataset, i.e. range overlap = 100
hundred <- zeroOrHundred(overlap=100, save=FALSE, verbose=FALSE)
```

# Run tests
```{r, eval=FALSE}
#set cores equal to the number of cores to use. Note this will not work across nodes.
specificityTestResults <- specificityTest(cores=1, save=FALSE)
sensitivityTestResults <- sensitivityTest(cores=1, save=FALSE)
```

# Dataset Examples {.tabset}
The plots below show example matrices from the zero and hundred datasets for points per group equal to 10 and 100. The plot for the zero dataset indicate, as expected, that group 1 and group 2 have zero spatial overlap with each other in either dimension. The plots for the hundred dataset indicate that the data points for group 1 are totally contained within the interval which group 2 occupies in both dimensions.

## Zero dataset 10 points
```{r showZeroDataset-10, fig.align='center', fig.height=8, fig.width=10, eval=TRUE, message=FALSE}
mat <- zero[['10.points']][,,'1.repitition']
groups <- makeGroups(list(mat), c("grp1", "grp2"))
visualizeOverlaps(list(mat), groups, plotType="points", cex=3)
```

## Zero dataset 100 points
```{r showZeroDataset-100, fig.align='center', fig.height=8, fig.width=10, eval=TRUE, message=FALSE}
mat <- zero[['100.points']][,,'1.repitition']
groups <- makeGroups(list(mat), c("grp1", "grp2"))
visualizeOverlaps(list(mat), groups, plotType="points", cex=3)
```

## Hundred dataset 10 points
```{r showHundredDataset-10, fig.align='center', fig.height=8, fig.width=10, eval=TRUE, message=FALSE}
mat <- hundred[['10.points']][,,'1.repitition']
groups <- makeGroups(list(mat), c("grp1", "grp2"))
visualizeOverlaps(list(mat), groups, plotType="points", cex=3)
```

## Hundred dataset 100 points
```{r showHundredDataset-100, fig.align='center', fig.height=8, fig.width=10, eval=TRUE, message=FALSE}
mat <- hundred[['100.points']][,,'1.repitition']
groups <- makeGroups(list(mat), c("grp1", "grp2"))
visualizeOverlaps(list(mat), groups, plotType="points", cex=3)
```

# Results
We ran ClusterSignificance using points per group from 10 to 100 at an interval of 10 with 10 repititions per number of points per group. This was performed with the [falseNegativeTest][Test Functions] and [falsePositiveTest][Test Functions] functions with their default arguments. The results were plotted with the [sensSpecPlot][Plot Functions] function and indicate that ClusterSignificance's Mlp and Pcp methods both have 100% sensivity and 99% specificity with this dataset.  

```{r FNresults, fig.align='center', fig.height=8, fig.width=10, eval=TRUE, message=FALSE}
sensSpecPlot(sens = sensitivityTestResults, spec = specificityTestResults)
```


<br></br><br></br><br></br><br></br>
